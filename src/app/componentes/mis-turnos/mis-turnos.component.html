<body>
    <section>
        <div class="container">
            <div class="row">
                <div class="col-lg-12">
                    <div class="card mb-4 p-4">

                        <div>
                            <h3 class="fw-bold">Mis Turnos</h3>

                            <div style="width: 100%;">
                                <h5> Filtros para {{this.AuthService.user.tipoUsuario == 'PAC' ? 'Especialista' :
                                    'Paciente'}}</h5>
                                <div class="row">
                                    <div class="col-md-4" *ngIf="this.AuthService.user.tipoUsuario == 'PAC'">
                                        <label for="firstName">Nombre: </label>
                                        <input type="text" class="form-control"
                                            placeholder="ingrese nombre del especialista..."
                                            [(ngModel)]="this.filtroNombreEspecialista">
                                    </div>
                                    <div class="col-md-4" *ngIf="this.AuthService.user.tipoUsuario == 'PAC'">
                                        <label for="firstName">Apellido: </label>
                                        <input type="text" class="form-control"
                                            placeholder="ingrese apellido del especialista..."
                                            [(ngModel)]="this.filtroApellidoEspecialista">
                                    </div>
                                    <div class="col-md-4" *ngIf="this.AuthService.user.tipoUsuario == 'ESP'">
                                        <label for="firstName">Nombre: </label>
                                        <input type="text" class="form-control"
                                            placeholder="ingrese nombre del paciente..."
                                            [(ngModel)]="this.filtroNombrePaciente">
                                    </div>
                                    <div class="col-md-4" *ngIf="this.AuthService.user.tipoUsuario == 'ESP'">
                                        <label for="firstName">Apellido: </label>
                                        <input type="text" class="form-control"
                                            placeholder="ingrese apellido del paciente..."
                                            [(ngModel)]="this.filtroApellidoPaciente">
                                    </div>

                                    <div class="col-md-4 btn-filter-clear">
                                        <button class="btn btn-medium btn-primary gap-2" (click)="clearFilters()">
                                            <i class="fa-solid fa-filter"></i>
                                            Limpiar filtros
                                        </button>
                                    </div>
                                </div>

                                <div class="row">
                                    <div class="col-md-5">
                                        <label for="firstName">Especialidad: </label>
                                        <input type="text" class="form-control" placeholder="ingrese especialidad..."
                                            [(ngModel)]="this.filtroEspecialidad">
                                    </div>

                                    <div class="col-md-5">
                                        <label for="firstName">Campo del turno/historia clinica: </label>
                                        <input type="text" class="form-control"
                                            placeholder="ingrese nombre del especialista..."
                                            [(ngModel)]="this.filtroCampoTurnoHistoriaClinica">
                                    </div>

                                </div>
                            </div>

                            <hr>

                            <div class="d-flex justify-content-center estados gap-3" align="center">
                                <a style="background-color: #ffff3d;">Pendiente</a>
                                <a style="background-color: #02d002;">Aceptado</a>
                                <a style="background-color: #f75d25;">Realizado</a>
                                <a style="background-color: #fa1616;">Cancelado</a>
                                <a style="background-color: #a30da3;">Rechazado</a>
                            </div>

                            <div class="d-flex align-items-center" *ngIf="this.spinner" style="color: #153A82;">
                                <span>Cargando lista...</span>
                                <div class="spinner-border ms-auto" role="status" aria-hidden="true"></div>
                            </div>

                            <table class="table table-striped table-bordered border-dark table-hover"
                                *ngIf="!this.spinner">
                                <thead class="table-dark" align="start">
                                    <tr>
                                        <th scope="col">Estado</th>
                                        <th scope="col">Fecha</th>
                                        <th scope="col">Especialidad</th>
                                        <th scope="col" *ngIf="this.AuthService.user.tipoUsuario == 'ESP'">Apellido</th>
                                        <th scope="col" *ngIf="this.AuthService.user.tipoUsuario == 'ESP'">Nombre</th>
                                        <th scope="col" *ngIf="this.AuthService.user.tipoUsuario == 'PAC'">Especialista
                                        </th>
                                        <th scope="col" *ngIf="this.AuthService.user.tipoUsuario == 'ESP'"></th>
                                        <th scope="col" *ngIf="this.AuthService.user.tipoUsuario == 'ESP'"></th>
                                        <th scope="col" *ngIf="this.AuthService.user.tipoUsuario == 'ESP'"></th>
                                        <th scope="col" *ngIf="this.AuthService.user.tipoUsuario == 'PAC'"></th>
                                    </tr>
                                </thead>
                                <tbody align="start">
                                    <tr
                                        *ngFor="let turno of (this.listTurnosCargados | filtroTurnosXNameEspecialista: filtroNombreEspecialista
                                                                                         | filtroTurnosXLastnameEspecialista: filtroApellidoEspecialista
                                                                                         | filtroTurnosXEspecialidad: filtroEspecialidad
                                                                                         | filtroTurnosXNamePaciente: filtroNombrePaciente
                                                                                         | filtroTurnosXLastnamePaciente: filtroApellidoPaciente
                                                                                         | filtroTurnosCualquierCampo: filtroCampoTurnoHistoriaClinica)">

                                        <td class="estado-line" [ngClass]="{
                                            'cancelado': turno?.estado_turno == 'Cancelado',
                                            'pendiente': turno?.estado_turno == 'Pendiente',
                                            'finalizado': turno?.estado_turno == 'Realizado',
                                            'aceptado': turno?.estado_turno == 'Aceptado',
                                            'rechazado': turno?.estado_turno == 'Rechazado'
                                        }">
                                            {{turno?.estado_turno}}
                                        </td>
                                        <td>{{turno?.fecha[0] +' - '+turno?.fecha[2]}}</td>
                                        <td>{{turno?.especialidad}}</td>
                                        <td class="text-capitalize" *ngIf="this.AuthService.user.tipoUsuario == 'ESP'">
                                            {{turno?.paciente.apellido}}</td>
                                        <td class="text-capitalize" *ngIf="this.AuthService.user.tipoUsuario == 'ESP'">
                                            {{turno?.paciente.nombre}}</td>
                                        <td class="text-capitalize" *ngIf="this.AuthService.user.tipoUsuario == 'PAC'">
                                            {{turno?.especialista.apellido + ' ' + turno?.especialista.nombre}}</td>
                                        <td>
                                            <div class="estado-line" *ngIf="turno.estado_turno == 'Pendiente' || 
                                                turno.estado_turno == 'Realizado' ||
                                                turno.estado_turno == 'Rechazado'">

                                                <button class="mt-1 btn btn-table"
                                                    [ngClass]="{'bg-cancelado': turno?.estado_turno == 'Pendiente'}"
                                                    *ngIf="(turno?.estado_turno == 'Pendiente' || 
                                                    turno?.estado_turno == 'Aceptado') && this.AuthService.user.tipoUsuario == 'PAC'"
                                                    (click)='cancelarTurno(turno,content)'>Cancelar</button>

                                                <button class="mt-1 btn btn-table"
                                                    [ngClass]="{'bg-cancelado': turno?.estado_turno == 'Pendiente'}"
                                                    *ngIf="(turno?.estado_turno == 'Pendiente') && this.AuthService.user.tipoUsuario == 'ESP'"
                                                    (click)='cancelarTurno(turno,content)'>Cancelar</button>
                                            </div>
                                        </td>


                                        <td *ngIf="turno.resenea != ''">
                                            <button class="mt-1 btn btn-table"
                                                [ngClass]="{'bg-realizado': turno?.estado_turno == 'Realizado'}"
                                                (click)='verResenea(turno,contentResenea)'>Ver Reseña</button>
                                        </td>

                                        <td *ngIf="turno.estado_turno == 'Realizado' &&
                                                turno.resenea != '' && this.AuthService.user.tipoUsuario == 'PAC'">
                                            <button class="mt-1 btn btn-table"
                                                [ngClass]="{'bg-realizado': turno?.estado_turno == 'Realizado'}"
                                                (click)='hacerEncuesta(turno,contentEncuesta)'>Hacer encuesta</button>
                                        </td>

                                        <td
                                            *ngIf="turno.estado_turno == 'Pendiente' && this.AuthService.user.tipoUsuario == 'ESP'">
                                            <button class="mt-1 btn btn-table"
                                                [ngClass]="{'bg-rechazado': turno?.estado_turno == 'Pendiente'}"
                                                (click)="rechazarTurno(turno,contentRechazoTurno)">Rechazar
                                            </button>
                                        </td>

                                        <td *ngIf="this.AuthService.user.tipoUsuario == 'ESP'">
                                            <button class="mt-1 btn btn-table"
                                                *ngIf="turno.estado_turno == 'Pendiente' && this.AuthService.user.tipoUsuario == 'ESP'"
                                                [ngClass]="{'bg-aceptado': turno?.estado_turno == 'Pendiente'}"
                                                (click)="aceptarTurno(turno)">Aceptar</button>
                                        </td>

                                        <td
                                            *ngIf="turno.estado_turno == 'Aceptado' && this.AuthService.user.tipoUsuario == 'ESP'">
                                            <button class="mt-1 btn btn-table"
                                                [ngClass]="{'bg-realizado': turno?.estado_turno == 'Aceptado'}"
                                                (click)="finalizarTurno(turno,contentReseneaEspecialista,contentAltaHistoriaClinica)">Finalizar
                                                Turno</button>
                                        </td>

                                        <td
                                            *ngIf="turno.estado_turno == 'Realizado' && this.AuthService.user.tipoUsuario == 'PAC'">
                                            <button class="mt-1 btn btn-table"
                                                [ngClass]="{'bg-realizado': turno?.estado_turno == 'Realizado'}"
                                                (click)='hacerCalificacion(turno,contentCalificacionAtencion)'>Calificacion</button>
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>


    <!-- CANCELAR - COMENTARIO -->
    <ng-template #content let-modal>
        <div class="modal-header">
            <h4 class="modal-title" id="modal-basic-title">Cancelacion de Turno</h4>
            <button type="button" class="btn-close" aria-label="Close" (click)="modal.dismiss('Cross click')"></button>
        </div>
        <div class="modal-body">
            <div class="mb-3">
                <label for="dateOfBirth">Comentario:</label>
                <div class="input-group">
                    <textarea class="form-control" placeholder="Ingrese un comentario"
                        [(ngModel)]="this.auxComentario"></textarea>
                </div>
            </div>
        </div>
        <div class="modal-footer">
            <button type="button" class="btn btn-outline-dark btn-danger" (click)="modal.close('Save click')"
                [disabled]="this.auxComentario == ''">Cancelar Turno</button>
        </div>
    </ng-template>


    <!-- Rechazar Turno -->
    <ng-template #contentRechazoTurno let-modal>
        <div class="modal-header">
            <h4 class="modal-title" id="modal-basic-title">Rechazo de Turno</h4>
            <button type="button" class="btn-close" aria-label="Close" (click)="modal.dismiss('Cross click')"></button>
        </div>
        <div class="modal-body">
            <div class="mb-3">
                <label for="dateOfBirth">Comentario:</label>
                <div class="input-group">
                    <textarea class="form-control" placeholder="Ingrese un comentario"
                        [(ngModel)]="this.comentarioRechazarTurno"></textarea>
                </div>
            </div>
        </div>
        <div class="modal-footer">
            <button type="button" class="btn btn-outline-dark btn-danger" (click)="modal.close('Save click')"
                [disabled]="this.comentarioRechazarTurno == ''">Cancelar Turno</button>
        </div>
    </ng-template>


    <!-- RESEÑA -->
    <ng-template #contentResenea let-modal>
        <div class="modal-header">
            <h4 class="modal-title" id="modal-basic-title">Reseña del Turno:</h4>
            <button type="button" class="btn-close" aria-label="Close" (click)="modal.dismiss('Cross click')"></button>
        </div>
        <div class="modal-body">
            {{this.reseneaTurno}}
        </div>
        <div class="modal-footer">
            <button type="button" class="btn btn-outline-dark" (click)="modal.close('Save click')">Cerrar</button>
        </div>
    </ng-template>


    <!-- ENCUESTA -->
    <ng-template #contentEncuesta let-modal>
        <div class="modal-header">
            <h4 class="modal-title" id="modal-basic-title">Formulario encuesta</h4>
            <button type="button" class="btn-close" aria-label="Close" (click)="modal.dismiss('Cross click')"></button>
        </div>
        <div class="modal-body">
            <div class="mb-3">
                <div class="input-group">
                    <label>Ingrese una calificacion:</label>
                    <ngb-rating [(rate)]="currentRate" style="font-size: 52px;color: yellow;"></ngb-rating>
                    <label>¿Que le parecio el sistema de turnos Online?:</label>
                    <div style="width: 100%;">
                        <input class="form-control" placeholder="Ingrese su respuesta"
                            [(ngModel)]="this.pregunta_1_encuesta">
                    </div>
                </div>

            </div>
        </div>
        <div class="modal-footer">
            <button type="button" class="btn btn-outline-dark btn-danger" (click)="modal.close('Save click')">Enviar
                Encuesta</button>
        </div>
    </ng-template>

    <!-- CALIFICACION ATENCION  -->
    <ng-template #contentCalificacionAtencion let-modal>
        <div class="modal-header">
            <h4 class="modal-title" id="modal-basic-title">Calificación de Atención</h4>
            <button type="button" class="btn-close" aria-label="Close" (click)="modal.dismiss('Cross click')"></button>
        </div>
        <div class="modal-body">
            <div class="mb-3">
                <label for="dateOfBirth">¿Que le parecio la Atencion?:</label>
                <div class="input-group">
                    <textarea class="form-control" placeholder="Ingrese un comentario"
                        [(ngModel)]="this.encuestaTexto"></textarea>
                </div>
            </div>
        </div>
        <div class="modal-footer">
            <button type="button" class="btn btn-outline-dark btn-danger" (click)="modal.close('Save click')"
                [disabled]="this.encuestaTexto == ''">Enviar Calificaicon</button>
        </div>
    </ng-template>

    <!-- RESEÑA ESPECIALISTA  -->
    <ng-template #contentReseneaEspecialista let-modal>
        <div class="modal-header">
            <h4 class="modal-title" id="modal-basic-title">Reseña del especialista</h4>
            <button type="button" class="btn-close" aria-label="Close" (click)="modal.dismiss('Cross click')"></button>
        </div>
        <div class="modal-body">
            <div class="mb-3">
                <label for="dateOfBirth">Diagnostico:</label>
                <div class="input-group">
                    <textarea class="form-control" placeholder="Ingrese la reseña o diagnostico.."
                        [(ngModel)]="this.reseneaDiagnosticoEsp"></textarea>
                </div>
            </div>
        </div>
        <div class="modal-footer">
            <button type="button" class="btn btn-outline-dark btn-danger" (click)="modal.close('Save click')"
                [disabled]="this.reseneaDiagnosticoEsp == ''">Enviar Calificaicon</button>
        </div>
    </ng-template>



    <!-- Alta de Historia Clinica -->
    <ng-template #contentAltaHistoriaClinica let-modal>
        <div class="modal-header">
            <h3 class="modal-title" id="modal-basic-title">Alta - Historia Clinica</h3>
        </div>
        <div class="modal-body">
            <div class="mb-3">
                <div class="input-grup">

                    <div class="row g-3">
                        <hr class="mb-4">
                        <div class="col-md-3">
                            <label for="firstName">Altura</label>
                            <input type="text" class="form-control" placeholder="Ingrese altura"
                                [(ngModel)]="this.altura">
                        </div>


                        <div class="col-md-3">
                            <label for="firstName">Peso</label>
                            <input type="text" class="form-control" placeholder="Ingrese peso" [(ngModel)]="this.peso">
                        </div>


                        <div class="col-md-3">
                            <label for="firstName">Temperatura</label>
                            <input type="text" class="form-control" placeholder="Ingrese temperatura"
                                [(ngModel)]="this.temperatura">
                        </div>

                        <div class="col-md-3">
                            <label for="firstName">Presion</label>
                            <input type="text" class="form-control" placeholder="Ingrese presion"
                                [(ngModel)]="this.presion">
                        </div>

                        <!-- datos adicionales -->
                        <h4>Datos adicionales</h4>
                        <hr class="mb-4">
                        <div class="col-md-5">
                            <label for="firstName">Tipo:</label>
                            <input type="text" class="form-control" placeholder="Ingrese tipo"
                                [(ngModel)]="this.dato_1_tipo">
                        </div>

                        <div class="col-md-5">
                            <label for="firstName">Descripcion o cantidad:</label>
                            <input type="text" class="form-control" placeholder="Ingrese dato aquí"
                                [(ngModel)]="this.dato_1_valor">
                        </div>

                        <div class="col-md-5">
                            <label for="firstName">Tipo:</label>
                            <input type="text" class="form-control" placeholder="Ingrese tipo"
                                [(ngModel)]="this.dato_2_tipo">
                        </div>

                        <div class="col-md-5">
                            <label for="firstName">Descripcion o cantidad:</label>
                            <input type="text" class="form-control" placeholder="Ingrese dato aquí"
                                [(ngModel)]="this.dato_2_valor">
                        </div>

                        <div class="col-md-5">
                            <label for="firstName">Tipo:</label>
                            <input type="text" class="form-control" placeholder="Ingrese tipo"
                                [(ngModel)]="this.dato_3_tipo">
                        </div>

                        <div class="col-md-5">
                            <label for="firstName">Descripcion o cantidad:</label>
                            <input type="text" class="form-control" placeholder="Ingrese dato aquí"
                                [(ngModel)]="this.dato_3_valor">
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="modal-footer">
            <button type="button" class="btn btn-outline-dark btn-danger" (click)="modal.close('Save click')">Generar
                Historia Clinica</button>
        </div>
    </ng-template>
</body>