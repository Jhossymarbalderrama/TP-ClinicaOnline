<body>
    <section>
        <div class="container background">
            <div class="row">
                <div class="col-lg-12">
                    <div class="card mb-4 box-shadow">
                        <div class="card-body">
                            <h1>Mis turnos</h1>

                            <div style="width: 100%;">
                                <div class="row row-12">
                                    <h3>Filtros</h3>                                    
                                    <div class="col-md-3 my-3" *ngIf="this.AuthService.user.tipoUsuario == 'PAC'">
                                        <label for="firstName">Nombre especialista: </label>
                                        <input type="text" class="form-control"
                                            placeholder="ingrese nombre del especialista..."
                                            [(ngModel)]="this.filtroNombreEspecialista">
                                    </div>
                                    <div class="col-md-3 my-3" *ngIf="this.AuthService.user.tipoUsuario == 'PAC'">
                                        <label for="firstName">Apellido especialista: </label>
                                        <input type="text" class="form-control"
                                            placeholder="ingrese apellido del especialista..."
                                            [(ngModel)]="this.filtroApellidoEspecialista">
                                    </div>
                                    <div class="col-md-3 my-3" *ngIf="this.AuthService.user.tipoUsuario == 'ESP'">
                                        <label for="firstName">Nombre paciente: </label>
                                        <input type="text" class="form-control"
                                            placeholder="ingrese nombre del paciente..."
                                            [(ngModel)]="this.filtroNombrePaciente">
                                    </div>
                                    <div class="col-md-3 my-3" *ngIf="this.AuthService.user.tipoUsuario == 'ESP'">
                                        <label for="firstName">Apellido paciente: </label>
                                        <input type="text" class="form-control"
                                            placeholder="ingrese apellido del paciente..."
                                            [(ngModel)]="this.filtroApellidoPaciente">
                                    </div>
                                    <div class="col-md-4 my-3">
                                        <label for="firstName">Especialidad: </label>
                                        <input type="text" class="form-control" placeholder="ingrese especialidad..."
                                            [(ngModel)]="this.filtroEspecialidad">
                                    </div>

                                    <div class="col-md-3 my-3">
                                        <label for="firstName">Campo del turno/historia clinica: </label>
                                        <input type="text" class="form-control"
                                            placeholder="ingrese nombre del especialista..."
                                            [(ngModel)]="this.filtroCampoTurnoHistoriaClinica">
                                    </div>
                                    <hr>
                                </div>
                                <div class="estados" align="center">
                                    <a style="background-color: rgb(255, 255, 61);">Pendiente</a>
                                    <a style="background-color: rgb(2, 208, 2);">Aceptado</a>
                                    <a style="background-color: rgb(247, 93, 37);">Realizado</a>
                                    <a style="background-color: rgb(250, 22, 22);">Cancelado</a>
                                    <a style="background-color: rgb(163, 13, 163);">Rechazado</a>
                                </div>

                                <div class="d-flex align-items-center" *ngIf="this.spinner" style="color: #153A82;">
                                    <strong>Cargando lista...</strong>
                                    <div class="spinner-border ms-auto" role="status" aria-hidden="true"></div>
                                </div>

                                <table class="table table-striped  table-hover" *ngIf="!this.spinner">
                                    <thead class="thead-dark" align="start">
                                        <tr>
                                            <th scope="col">Estado</th>
                                            <th scope="col">Fecha</th>
                                            <th scope="col">Especialidad</th>
                                            <th scope="col" *ngIf="this.AuthService.user.tipoUsuario == 'ESP'">Apellido
                                            </th>
                                            <th scope="col" *ngIf="this.AuthService.user.tipoUsuario == 'ESP'">Nombre
                                            </th>
                                            <th scope="col" *ngIf="this.AuthService.user.tipoUsuario == 'PAC'">
                                                Especialista</th>
                                            <th scope="col"></th>
                                            <th scope="col"></th>
                                            <th scope="col"></th>
                                            <th scope="col"></th>
                                        </tr>
                                    </thead>
                                    <tbody align="start">
                                        <tr
                                            *ngFor="let turno of (this.listTurnosCargados | filtroTurnosXNameEspecialista: filtroNombreEspecialista
                                                                                         | filtroTurnosXLastnameEspecialista: filtroApellidoEspecialista
                                                                                         | filtroTurnosXEspecialidad: filtroEspecialidad
                                                                                         | filtroTurnosXNamePaciente: filtroNombrePaciente
                                                                                         | filtroTurnosXLastnamePaciente: filtroApellidoPaciente
                                                                                         | filtroTurnosCualquierCampo: filtroCampoTurnoHistoriaClinica)">

                                            <td style="font-size: 24px;font-weight: bold;color: rgb(255, 255, 61);text-shadow: 2px 2px 2px rgb(19, 19, 19);"
                                                [ngClass]="{'cancelado': turno?.estado_turno == 'Cancelado'}">
                                                {{turno?.estado_turno}}
                                            </td>
                                            <td>{{turno?.fecha[0] +' - '+turno?.fecha[2]}}</td>
                                            <td>{{turno?.especialidad}}</td>
                                            <td *ngIf="this.AuthService.user.tipoUsuario == 'ESP'">
                                                {{turno?.paciente.apellido}}</td>
                                            <td *ngIf="this.AuthService.user.tipoUsuario == 'ESP'">
                                                {{turno?.paciente.nombre}}</td>
                                            <td *ngIf="this.AuthService.user.tipoUsuario == 'PAC'">
                                                {{turno?.especialista.apellido + ' ' + turno?.especialista.nombre}}</td>
                                            <td *ngIf="turno.estado_turno == 'Pendiente' || 
                                                       turno.estado_turno == 'Realizado' ||
                                                       turno.estado_turno == 'Rechazado'">
                                                <button class="mt-1 btn btn-outline-dark"
                                                    style="background-color: rgb(255, 255, 61);color: black;"
                                                    *ngIf="(turno?.estado_turno == 'Pendiente' || 
                                                           turno?.estado_turno == 'Aceptado') && this.AuthService.user.tipoUsuario == 'PAC'"
                                                    (click)='cancelarTurno(turno,content)'>Cancelar turno</button>
                                                <button class="mt-1 btn btn-outline-dark"
                                                    style="background-color: rgb(255, 255, 61);color: black;"
                                                    *ngIf="(turno?.estado_turno == 'Pendiente') && this.AuthService.user.tipoUsuario == 'ESP'"
                                                    (click)='cancelarTurno(turno,content)'>Cancelar turno</button>
                                            </td>
                                            <td *ngIf="turno.resenea != ''">
                                                <button class="mt-1 btn btn-outline-dark"
                                                    style="background-color: rgb(255, 255, 61);color: black;"
                                                    (click)='verResenea(turno,contentResenea)'>Reseña turno</button>
                                            </td>
                                            <td *ngIf="turno.estado_turno == 'Realizado' &&
                                                turno.resenea != '' && this.AuthService.user.tipoUsuario == 'PAC'">
                                                <button class="mt-1 btn btn-outline-dark"
                                                    style="background-color: rgb(255, 255, 61);color: black;"
                                                    (click)='hacerEncuesta(turno,contentEncuesta)'>Encuesta
                                                    turno</button>
                                            </td>

                                            <td
                                                *ngIf="turno.estado_turno == 'Pendiente' && this.AuthService.user.tipoUsuario == 'ESP'">
                                                <button class="mt-1 btn btn-outline-dark"
                                                    style="background-color: rgb(255, 255, 61);color: black;"
                                                    (click)="rechazarTurno(turno,contentRechazoTurno)">Rechazar
                                                    Turno</button>
                                            </td>

                                            <td
                                                *ngIf="turno.estado_turno == 'Pendiente' && this.AuthService.user.tipoUsuario == 'ESP'">
                                                <button class="mt-1 btn btn-outline-dark"
                                                    style="background-color: rgb(255, 255, 61);color: black;"
                                                    (click)="aceptarTurno(turno)">Aceptar Turno</button>
                                            </td>

                                            <td
                                                *ngIf="turno.estado_turno == 'Aceptado' && this.AuthService.user.tipoUsuario == 'ESP'">
                                                <button class="mt-1 btn btn-outline-dark"
                                                    style="background-color: rgb(255, 255, 61);color: black;"
                                                    (click)="finalizarTurno(turno,contentReseneaEspecialista,contentAltaHistoriaClinica)">Finalizar
                                                    Turno</button>
                                            </td>

                                            <td
                                                *ngIf="turno.estado_turno == 'Realizado' && this.AuthService.user.tipoUsuario == 'PAC'">
                                                <button class="mt-1 btn btn-outline-dark"
                                                    style="background-color: rgb(255, 255, 61);color: black;"
                                                    (click)='hacerCalificacion(turno,contentCalificacionAtencion)'>Calificacion</button>
                                            </td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>


    <!-- CANCELAR - COMENTARIO -->
    <ng-template #content let-modal>
        <div class="modal-header">
            <h4 class="modal-title" id="modal-basic-title">Cancelacion de Turno</h4>
            <button type="button" class="btn-close" aria-label="Close" (click)="modal.dismiss('Cross click')"></button>
        </div>
        <div class="modal-body">
            <div class="mb-3">
                <label for="dateOfBirth">Comentario:</label>
                <div class="input-group">
                    <textarea class="form-control" placeholder="Ingrese un comentario"
                        [(ngModel)]="this.auxComentario"></textarea>
                </div>
            </div>
        </div>
        <div class="modal-footer">
            <button type="button" class="btn btn-outline-dark btn-danger" (click)="modal.close('Save click')"
                [disabled]="this.auxComentario == ''">Cancelar Turno</button>
        </div>
    </ng-template>


    <!-- Rechazar Turno -->
    <ng-template #contentRechazoTurno let-modal>
        <div class="modal-header">
            <h4 class="modal-title" id="modal-basic-title">Rechazo de Turno</h4>
            <button type="button" class="btn-close" aria-label="Close" (click)="modal.dismiss('Cross click')"></button>
        </div>
        <div class="modal-body">
            <div class="mb-3">
                <label for="dateOfBirth">Comentario:</label>
                <div class="input-group">
                    <textarea class="form-control" placeholder="Ingrese un comentario"
                        [(ngModel)]="this.comentarioRechazarTurno"></textarea>
                </div>
            </div>
        </div>
        <div class="modal-footer">
            <button type="button" class="btn btn-outline-dark btn-danger" (click)="modal.close('Save click')"
                [disabled]="this.comentarioRechazarTurno == ''">Cancelar Turno</button>
        </div>
    </ng-template>


    <!-- RESEÑA -->
    <ng-template #contentResenea let-modal>
        <div class="modal-header">
            <h4 class="modal-title" id="modal-basic-title">Reseña del Turno:</h4>
            <button type="button" class="btn-close" aria-label="Close" (click)="modal.dismiss('Cross click')"></button>
        </div>
        <div class="modal-body">
            {{this.reseneaTurno}}
        </div>
        <div class="modal-footer">
            <button type="button" class="btn btn-outline-dark" (click)="modal.close('Save click')">Cerrar</button>
        </div>
    </ng-template>


    <!-- ENCUESTA -->
    <ng-template #contentEncuesta let-modal>
        <div class="modal-header">
            <h4 class="modal-title" id="modal-basic-title">Formulario encuesta</h4>
            <button type="button" class="btn-close" aria-label="Close" (click)="modal.dismiss('Cross click')"></button>
        </div>
        <div class="modal-body">
            <div class="mb-3">
                <div class="input-group">
                    <label>Ingrese una calificacion:</label>
                    <ngb-rating [(rate)]="currentRate" style="font-size: 52px;color: yellow;"></ngb-rating>
                    <label>¿Que le parecio el sistema de turnos Online?:</label>
                    <div style="width: 100%;">
                        <input class="form-control" placeholder="Ingrese su respuesta"
                            [(ngModel)]="this.pregunta_1_encuesta">
                    </div>
                </div>

            </div>
        </div>
        <div class="modal-footer">
            <button type="button" class="btn btn-outline-dark btn-danger" (click)="modal.close('Save click')">Enviar
                Encuesta</button>
        </div>
    </ng-template>

    <!-- CALIFICACION ATENCION  -->
    <ng-template #contentCalificacionAtencion let-modal>
        <div class="modal-header">
            <h4 class="modal-title" id="modal-basic-title">Calificación de Atención</h4>
            <button type="button" class="btn-close" aria-label="Close" (click)="modal.dismiss('Cross click')"></button>
        </div>
        <div class="modal-body">
            <div class="mb-3">
                <label for="dateOfBirth">¿Que le parecio la Atencion?:</label>
                <div class="input-group">
                    <textarea class="form-control" placeholder="Ingrese un comentario"
                        [(ngModel)]="this.encuestaTexto"></textarea>
                </div>
            </div>
        </div>
        <div class="modal-footer">
            <button type="button" class="btn btn-outline-dark btn-danger" (click)="modal.close('Save click')"
                [disabled]="this.encuestaTexto == ''">Enviar Calificaicon</button>
        </div>
    </ng-template>

    <!-- RESEÑA ESPECIALISTA  -->
    <ng-template #contentReseneaEspecialista let-modal>
        <div class="modal-header">
            <h4 class="modal-title" id="modal-basic-title">Reseña del especialista</h4>
            <button type="button" class="btn-close" aria-label="Close" (click)="modal.dismiss('Cross click')"></button>
        </div>
        <div class="modal-body">
            <div class="mb-3">
                <label for="dateOfBirth">Diagnostico:</label>
                <div class="input-group">
                    <textarea class="form-control" placeholder="Ingrese la reseña o diagnostico.."
                        [(ngModel)]="this.reseneaDiagnosticoEsp"></textarea>
                </div>
            </div>
        </div>
        <div class="modal-footer">
            <button type="button" class="btn btn-outline-dark btn-danger" (click)="modal.close('Save click')"
                [disabled]="this.reseneaDiagnosticoEsp == ''">Enviar Calificaicon</button>
        </div>
    </ng-template>



    <!-- Alta de Historia Clinica -->
    <ng-template #contentAltaHistoriaClinica let-modal>
        <div class="modal-header">
            <h3 class="modal-title" id="modal-basic-title">Alta - Historia Clinica</h3>            
        </div>
        <div class="modal-body">
            <div class="mb-3">          
                <div class="input-grup">

                    <div class="row g-3">
                        <hr class="mb-4">
                        <div class="col-md-3">
                            <label for="firstName">Altura</label>
                            <input type="text" class="form-control" placeholder="Ingrese altura" [(ngModel)]="this.altura">
                        </div>


                        <div class="col-md-3">
                            <label for="firstName">Peso</label>
                            <input type="text" class="form-control" placeholder="Ingrese peso" [(ngModel)]="this.peso">
                        </div>


                        <div class="col-md-3">
                            <label for="firstName">Temperatura</label>
                            <input type="text" class="form-control" placeholder="Ingrese temperatura" [(ngModel)]="this.temperatura">
                        </div>

                        <div class="col-md-3">
                            <label for="firstName">Presion</label>
                            <input type="text" class="form-control" placeholder="Ingrese presion" [(ngModel)]="this.presion">
                        </div>

                        <!-- datos adicionales -->
                        <h4>Datos adicionales</h4>
                        <hr class="mb-4">
                        <div class="col-md-5">
                            <label for="firstName">Tipo:</label>
                            <input type="text" class="form-control" placeholder="Ingrese tipo" [(ngModel)]="this.dato_1_tipo">                            
                        </div>
                    
                        <div class="col-md-5">
                            <label for="firstName">Descripcion o cantidad:</label>
                            <input type="text" class="form-control" placeholder="Ingrese dato aquí" [(ngModel)]="this.dato_1_valor">
                        </div>

                        <div class="col-md-5">
                            <label for="firstName">Tipo:</label>
                            <input type="text" class="form-control" placeholder="Ingrese tipo" [(ngModel)]="this.dato_2_tipo">                            
                        </div>
                    
                        <div class="col-md-5">
                            <label for="firstName">Descripcion o cantidad:</label>
                            <input type="text" class="form-control" placeholder="Ingrese dato aquí" [(ngModel)]="this.dato_2_valor">
                        </div>

                        <div class="col-md-5">
                            <label for="firstName">Tipo:</label>
                            <input type="text" class="form-control" placeholder="Ingrese tipo" [(ngModel)]="this.dato_3_tipo">                            
                        </div>
                    
                        <div class="col-md-5">
                            <label for="firstName">Descripcion o cantidad:</label>
                            <input type="text" class="form-control" placeholder="Ingrese dato aquí" [(ngModel)]="this.dato_3_valor">
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="modal-footer">
            <button type="button" class="btn btn-outline-dark btn-danger" (click)="modal.close('Save click')"
            >Generar Historia Clinica</button>
        </div>
    </ng-template>
</body>